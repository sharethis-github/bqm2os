"-- select categories.text, count(1) as c from\n-- (\n-- --  select * from\n--   (\n--     select url, categories.text, categories.score as score, max(categories.score) within record as max_score \n--     from [dataset_prod_hourly.mergelog_mini_hour_00_20161225] \n--     where domain = \"newhampshire.com\"\n--   )\n-- --  group by url, categories.text, score, max_score\n-- ) group by categories.text order by c desc\n\nselect domain, float(auto_count)/float(total_count) as p, auto_count, total_count from\n(\n  select domain, count(distinct url) as total_count,\n  count(distinct case when categories.text like \"/autos_&_vehicles%\" then url else null end) as auto_count\n  from [mergelog.v1_20161228]\n  where float(categories.score) > 0.8\n  group by domain\n)\nwhere total_count > 1000\norder by p desc\nlimit 20\n"
